# 🌐 FayCR連線室 - 完整安裝與設置指南

這是一個具有真實電子郵件驗證功能的完整認證系統。

## 📋 系統需求

- Node.js 14+ 
- npm 或 yarn
- Gmail 帳號（用於發送驗證郵件）
- 現代瀏覽器

## 🚀 快速開始

### 1. 安裝依賴

```bash
# 安裝後端依賴
npm install

# 如果您沒有 Node.js，請先安裝：
# https://nodejs.org/
```

### 2. 配置郵件服務

#### 📧 Gmail 設置（推薦）

1. **開啟 2 步驟驗證**
   - 前往：https://myaccount.google.com/security
   - 開啟「2 步驟驗證」

2. **生成應用程式密碼**
   - 前往：https://myaccount.google.com/apppasswords
   - 選擇「郵件」應用程式
   - 選擇您的設備
   - 複製生成的 16 位密碼（移除空格）

3. **編輯配置文件**
   
   打開 `config.js` 並修改以下設置：
   
   ```javascript
   module.exports = {
       email: {
           host: 'smtp.gmail.com',
           port: 587,
           secure: false,
           auth: {
               user: '您的Gmail地址@gmail.com',     // 替換這裡
               pass: '您的16位應用程式密碼'           // 替換這裡（無空格）
           },
           from: {
               email: '您的Gmail地址@gmail.com',     // 替換這裡
               name: 'FayCR連線室'
           }
       },
       // ... 其他配置保持不變
   };
   ```

#### 📧 其他郵件服務商

如果您使用其他郵件服務，請修改 `config.js` 中的 SMTP 設置：

```javascript
// Outlook
host: 'smtp-mail.outlook.com',
port: 587,

// Yahoo
host: 'smtp.mail.yahoo.com', 
port: 587,

// QQ郵箱
host: 'smtp.qq.com',
port: 587,

// 163郵箱  
host: 'smtp.163.com',
port: 25,
```

### 3. 啟動系統

#### 方法一：同時啟動前後端

```bash
# 終端1：啟動後端服務器
npm start

# 終端2：啟動前端服務器（新開終端窗口）
python -m http.server 8080
```

#### 方法二：使用開發模式

```bash
# 後端開發模式（自動重啟）
npm run dev

# 前端仍需單獨啟動
python -m http.server 8080
```

### 4. 訪問應用

- **前端**：http://localhost:8080
- **後端API**：http://localhost:3001
- **健康檢查**：http://localhost:3001/api/health
- **郵件測試**：http://localhost:3001/api/test-email

## 🔧 配置詳解

### 配置文件結構

```javascript
module.exports = {
    // 郵件服務配置
    email: {
        host: 'smtp.gmail.com',           // SMTP 服務器
        port: 587,                        // 端口號
        secure: false,                    // 是否使用 SSL
        auth: {
            user: 'your-email@gmail.com', // 發送郵箱
            pass: 'your-app-password'     // 應用程式密碼
        },
        from: {
            email: 'your-email@gmail.com', // 發送者郵箱
            name: 'FayCR連線室'             // 發送者名稱
        }
    },
    
    // 服務器配置
    server: {
        port: 3001,                           // 後端端口
        jwtSecret: 'your-secret-key',         // JWT 密鑰（請修改）
        corsOrigin: 'http://localhost:8080'   // 前端地址
    },
    
    // 數據庫配置
    database: {
        filename: './faycr_users.db'         // SQLite 數據庫文件
    }
};
```

## 🧪 測試郵件服務

在啟動後端後，訪問以下URL測試郵件配置：

```
GET http://localhost:3001/api/test-email
```

如果配置正確，您會看到：
```json
{
    "success": true,
    "message": "郵件服務連接正常"
}
```

## 📱 使用流程

### 新用戶註冊

1. 訪問 http://localhost:8080
2. 點擊「註冊」按鈕
3. 填寫：
   - 使用者名稱
   - 電子郵件（必須是真實郵箱）
   - 密碼（至少6位）
   - 確認密碼
   - 頭像（可選）
4. 點擊「註冊」
5. 檢查您的郵箱，找到6位數驗證碼
6. 輸入驗證碼完成註冊

### 用戶登入

1. 點擊「登入」按鈕
2. 輸入註冊時的郵箱和密碼
3. 成功登入後，右上角會顯示您的頭像和名字

## 🛠 API 端點

### 認證相關

- `POST /api/register` - 用戶註冊
- `POST /api/verify-email` - 驗證電子郵件
- `POST /api/resend-verification` - 重發驗證碼
- `POST /api/login` - 用戶登入
- `GET /api/user` - 獲取用戶資訊（需要認證）

### 系統相關

- `GET /api/health` - 健康檢查
- `GET /api/test-email` - 測試郵件服務

## 🗃 數據庫

系統使用 SQLite 數據庫，數據文件為 `faycr_users.db`。

### 數據表結構

#### users 表
- `id` - 主鍵
- `username` - 使用者名稱
- `email` - 電子郵件（唯一）
- `password_hash` - 加密後的密碼
- `avatar_data` - 頭像數據（Base64）
- `is_verified` - 是否已驗證
- `verification_code` - 驗證碼
- `verification_expires` - 驗證碼過期時間
- `created_at` - 創建時間
- `updated_at` - 更新時間

## 🔒 安全特性

- ✅ 密碼使用 bcrypt 加密
- ✅ JWT 認證令牌
- ✅ 驗證碼15分鐘過期
- ✅ 請求速率限制
- ✅ CORS 安全配置
- ✅ 輸入驗證和清理
- ✅ SQL 注入保護

## 🎨 功能特色

- ✅ 真實電子郵件發送
- ✅ 精美的響應式設計
- ✅ 頭像上傳和預覽
- ✅ 即時表單驗證
- ✅ 流暢的動畫效果
- ✅ 完整的錯誤處理
- ✅ 用戶狀態持久化

## ❌ 常見問題

### 1. 郵件發送失敗

**問題**：收到 "郵件服務初始化失敗" 錯誤

**解決方案**：
- 檢查 Gmail 是否開啟 2 步驟驗證
- 確認應用程式密碼是否正確（16位，無空格）
- 檢查網絡連接
- 嘗試使用其他郵件服務商

### 2. 無法連接後端

**問題**：前端無法連接到後端 API

**解決方案**：
- 確認後端服務器正在運行（http://localhost:3001）
- 檢查防火牆設置
- 確認端口 3001 沒有被其他程序占用

### 3. 驗證碼收不到

**問題**：註冊後收不到驗證郵件

**解決方案**：
- 檢查垃圾郵件資料夾
- 確認郵箱地址輸入正確
- 查看後端控制台是否有錯誤信息
- 使用 "重新發送驗證碼" 功能

### 4. Node.js 相關錯誤

**問題**：npm install 失敗或模塊找不到

**解決方案**：
```bash
# 清理 npm 緩存
npm cache clean --force

# 刪除 node_modules 並重新安裝
rm -rf node_modules package-lock.json
npm install

# 如果還有問題，嘗試使用 yarn
npm install -g yarn
yarn install
```

## 🌟 高級配置

### 自定義郵件模板

編輯 `emailService.js` 中的 `generateVerificationEmailHTML` 函數來自定義郵件模板。

### 修改驗證碼過期時間

在 `database.js` 中修改：
```javascript
const verificationExpires = Date.now() + 15 * 60 * 1000; // 15分鐘
```

### 更改 JWT 過期時間

在 `server.js` 中修改：
```javascript
{ expiresIn: '7d' } // 7天
```

## 📞 技術支持

如果您在設置過程中遇到問題，請：

1. 檢查控制台錯誤信息
2. 確認所有配置正確
3. 查看本文檔的常見問題部分
4. 檢查 Node.js 和 npm 版本是否符合要求

## 🎉 享受使用！

設置完成後，您就擁有了一個功能完整的認證系統，支持：
- 真實的電子郵件驗證
- 安全的用戶認證
- 精美的用戶界面
- 完整的用戶管理

現在可以開始使用您的 FayCR連線室 了！🚀
